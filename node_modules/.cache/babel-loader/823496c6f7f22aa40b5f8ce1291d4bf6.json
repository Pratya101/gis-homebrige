{"remainingRequest":"/Users/pratyaphocha/village-servay/node_modules/babel-loader/lib/index.js!/Users/pratyaphocha/village-servay/node_modules/eslint-loader/index.js??ref--13-0!/Users/pratyaphocha/village-servay/src/store/auth.js","dependencies":[{"path":"/Users/pratyaphocha/village-servay/src/store/auth.js","mtime":1626370293319},{"path":"/Users/pratyaphocha/village-servay/node_modules/cache-loader/dist/cjs.js","mtime":1626176668222},{"path":"/Users/pratyaphocha/village-servay/node_modules/babel-loader/lib/index.js","mtime":1626179369206},{"path":"/Users/pratyaphocha/village-servay/node_modules/eslint-loader/index.js","mtime":1626176668724}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGNvbmZpZyBmcm9tICIuLi9jb25maWciOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwppbXBvcnQgand0IGZyb20gImpzb253ZWJ0b2tlbiI7CmltcG9ydCByb3V0ZXIgZnJvbSAiLi4vUm91dGVzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWVzcGFjZWQ6IHRydWUsCiAgc3RhdGU6IHsKICAgIGlzRmV0Y2hpbmc6IGZhbHNlLAogICAgZXJyb3JNZXNzYWdlOiAiIgogIH0sCiAgbXV0YXRpb25zOiB7CiAgICBMT0dJTl9GQUlMVVJFOiBmdW5jdGlvbiBMT0dJTl9GQUlMVVJFKHN0YXRlLCBwYXlsb2FkKSB7CiAgICAgIHN0YXRlLmlzRmV0Y2hpbmcgPSBmYWxzZTsKICAgICAgc3RhdGUuZXJyb3JNZXNzYWdlID0gcGF5bG9hZDsKICAgIH0sCiAgICBMT0dJTl9TVUNDRVNTOiBmdW5jdGlvbiBMT0dJTl9TVUNDRVNTKHN0YXRlKSB7CiAgICAgIHN0YXRlLmlzRmV0Y2hpbmcgPSBmYWxzZTsKICAgICAgc3RhdGUuZXJyb3JNZXNzYWdlID0gIiI7CiAgICB9LAogICAgTE9HSU5fUkVRVUVTVDogZnVuY3Rpb24gTE9HSU5fUkVRVUVTVChzdGF0ZSkgewogICAgICBzdGF0ZS5pc0ZldGNoaW5nID0gdHJ1ZTsKICAgIH0KICB9LAogIGFjdGlvbnM6IHsKICAgIGxvZ2luVXNlcjogZnVuY3Rpb24gbG9naW5Vc2VyKF9yZWYsIGNyZWRzKSB7CiAgICAgIHZhciBkaXNwYXRjaCA9IF9yZWYuZGlzcGF0Y2g7CgogICAgICBpZiAoIWNvbmZpZy5pc0JhY2tlbmQpIHsKICAgICAgICBkaXNwYXRjaCgicmVjZWl2ZVRva2VuIiwgInRva2VuIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGlzcGF0Y2goInJlcXVlc3RMb2dpbiIpOwoKICAgICAgICBpZiAoY3JlZHMuc29jaWFsKSB7CiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGNvbmZpZy5iYXNlVVJMQXBpICsgIi9hdXRoL3NpZ25pbi8iICsgY3JlZHMuc29jaWFsICsgIj9hcHA9IiArIGNvbmZpZy5yZWRpcmVjdFVybDsKICAgICAgICB9IGVsc2UgaWYgKGNyZWRzLmVtYWlsLmxlbmd0aCA+IDAgJiYgY3JlZHMucGFzc3dvcmQubGVuZ3RoID4gMCkgewogICAgICAgICAgYXhpb3MucG9zdCgiL2F1dGgvc2lnbmluL2xvY2FsIiwgY3JlZHMpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgICB2YXIgdG9rZW4gPSByZXMuZGF0YTsKICAgICAgICAgICAgZGlzcGF0Y2goInJlY2VpdmVUb2tlbiIsIHRva2VuKTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICAgICAgZGlzcGF0Y2goImxvZ2luRXJyb3IiLCBlcnIucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGlzcGF0Y2goImxvZ2luRXJyb3IiLCAiU29tZXRoaW5nIHdhcyB3cm9uZy4gVHJ5IGFnYWluIik7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgcmVjZWl2ZVRva2VuOiBmdW5jdGlvbiByZWNlaXZlVG9rZW4oX3JlZjIsIHRva2VuKSB7CiAgICAgIHZhciBkaXNwYXRjaCA9IF9yZWYyLmRpc3BhdGNoOwogICAgICB2YXIgdXNlciA9IHt9OyAvLyBXZSBjaGVjayBpZiBhcHAgcnVucyB3aXRoIGJhY2tlbmQgbW9kZQoKICAgICAgaWYgKGNvbmZpZy5pc0JhY2tlbmQpIHsKICAgICAgICB1c2VyID0gand0LmRlY29kZSh0b2tlbikudXNlcjsKICAgICAgICBkZWxldGUgdXNlci5pZDsKICAgICAgfSBlbHNlIHsKICAgICAgICB1c2VyID0gewogICAgICAgICAgZW1haWw6IGNvbmZpZy5hdXRoLmVtYWlsCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInRva2VuIiwgdG9rZW4pOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidXNlciIsIEpTT04uc3RyaW5naWZ5KHVzZXIpKTsKICAgICAgYXhpb3MuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bIkF1dGhvcml6YXRpb24iXSA9ICJCZWFyZXIgIiArIHRva2VuOwogICAgICBkaXNwYXRjaCgicmVjZWl2ZUxvZ2luIik7CiAgICB9LAogICAgbG9nb3V0VXNlcjogZnVuY3Rpb24gbG9nb3V0VXNlcigpIHsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oInRva2VuIik7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJ1c2VyIik7CiAgICAgIGRvY3VtZW50LmNvb2tpZSA9ICJ0b2tlbj07ZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAxIEdNVDsiOwogICAgICBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsiQXV0aG9yaXphdGlvbiJdID0gIiI7CiAgICAgIHJvdXRlci5wdXNoKCIvbG9naW4iKTsKICAgIH0sCiAgICBsb2dpbkVycm9yOiBmdW5jdGlvbiBsb2dpbkVycm9yKF9yZWYzLCBwYXlsb2FkKSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmMy5jb21taXQ7CiAgICAgIGNvbW1pdCgiTE9HSU5fRkFJTFVSRSIsIHBheWxvYWQpOwogICAgfSwKICAgIHJlY2VpdmVMb2dpbjogZnVuY3Rpb24gcmVjZWl2ZUxvZ2luKF9yZWY0KSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmNC5jb21taXQ7CiAgICAgIGNvbW1pdCgiTE9HSU5fU1VDQ0VTUyIpOwogICAgICByb3V0ZXIucHVzaCgiL21hcCIpOwogICAgfSwKICAgIHJlcXVlc3RMb2dpbjogZnVuY3Rpb24gcmVxdWVzdExvZ2luKF9yZWY1KSB7CiAgICAgIHZhciBjb21taXQgPSBfcmVmNS5jb21taXQ7CiAgICAgIGNvbW1pdCgiTE9HSU5fUkVRVUVTVCIpOwogICAgfQogIH0KfTs="},{"version":3,"sources":["/Users/pratyaphocha/village-servay/src/store/auth.js"],"names":["config","axios","jwt","router","namespaced","state","isFetching","errorMessage","mutations","LOGIN_FAILURE","payload","LOGIN_SUCCESS","LOGIN_REQUEST","actions","loginUser","creds","dispatch","isBackend","social","window","location","href","baseURLApi","redirectUrl","email","length","password","post","then","res","token","data","catch","err","response","receiveToken","user","decode","id","auth","localStorage","setItem","JSON","stringify","defaults","headers","common","logoutUser","removeItem","document","cookie","push","loginError","commit","receiveLogin","requestLogin"],"mappings":"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","sourcesContent":["import config from \"../config\";\nimport axios from \"axios\";\nimport jwt from \"jsonwebtoken\";\nimport router from \"../Routes\";\n\nexport default {\n  namespaced: true,\n  state: {\n    isFetching: false,\n    errorMessage: \"\",\n  },\n  mutations: {\n    LOGIN_FAILURE(state, payload) {\n      state.isFetching = false;\n      state.errorMessage = payload;\n    },\n    LOGIN_SUCCESS(state) {\n      state.isFetching = false;\n      state.errorMessage = \"\";\n    },\n    LOGIN_REQUEST(state) {\n      state.isFetching = true;\n    },\n  },\n  actions: {\n    loginUser({ dispatch }, creds) {\n      if (!config.isBackend) {\n        dispatch(\"receiveToken\", \"token\");\n      } else {\n        dispatch(\"requestLogin\");\n        if (creds.social) {\n          window.location.href =\n            config.baseURLApi +\n            \"/auth/signin/\" +\n            creds.social +\n            \"?app=\" +\n            config.redirectUrl;\n        } else if (creds.email.length > 0 && creds.password.length > 0) {\n          axios\n            .post(\"/auth/signin/local\", creds)\n            .then((res) => {\n              const token = res.data;\n              dispatch(\"receiveToken\", token);\n            })\n            .catch((err) => {\n              dispatch(\"loginError\", err.response.data);\n            });\n        } else {\n          dispatch(\"loginError\", \"Something was wrong. Try again\");\n        }\n      }\n    },\n    receiveToken({ dispatch }, token) {\n      let user = {};\n      // We check if app runs with backend mode\n      if (config.isBackend) {\n        user = jwt.decode(token).user;\n        delete user.id;\n      } else {\n        user = {\n          email: config.auth.email,\n        };\n      }\n\n      localStorage.setItem(\"token\", token);\n      localStorage.setItem(\"user\", JSON.stringify(user));\n      axios.defaults.headers.common[\"Authorization\"] = \"Bearer \" + token;\n      dispatch(\"receiveLogin\");\n    },\n    logoutUser() {\n      localStorage.removeItem(\"token\");\n      localStorage.removeItem(\"user\");\n      document.cookie = \"token=;expires=Thu, 01 Jan 1970 00:00:01 GMT;\";\n      axios.defaults.headers.common[\"Authorization\"] = \"\";\n      router.push(\"/login\");\n    },\n    loginError({ commit }, payload) {\n      commit(\"LOGIN_FAILURE\", payload);\n    },\n    receiveLogin({ commit }) {\n      commit(\"LOGIN_SUCCESS\");\n      router.push(\"/map\");\n    },\n    requestLogin({ commit }) {\n      commit(\"LOGIN_REQUEST\");\n    },\n  },\n};\n"]}]}